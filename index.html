<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solo Clinic - Professional HIMS</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@300;400;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* INLINE STYLES FOR CRITICAL LAYOUT ELEMENTS (To ensure structure before CSS loads) */
    body { opacity: 0; animation: fadeInPage 0.5s forwards; }
    @keyframes fadeInPage { to { opacity: 1; } }
    
    /* Specific styles for the new Macro and Safety features */
    .macro-bar { display: flex; gap: 8px; padding: 10px 16px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; overflow-x: auto; scrollbar-width: none; }
    .macro-btn { font-size: 11px; padding: 5px 12px; border-radius: 16px; border: 1px solid #cbd5e1; background: white; color: #475569; cursor: pointer; transition: all 0.2s; white-space: nowrap; font-weight: 500; }
    .macro-btn:hover { border-color: #2563eb; color: #2563eb; background: #eff6ff; transform: translateY(-1px); }
    
    .rx-safety-banner { background: #fef2f2; border-left: 4px solid #ef4444; color: #b91c1c; padding: 12px 16px; font-size: 12px; font-weight: 600; display: none; align-items: center; justify-content: space-between; border-bottom: 1px solid #fecaca; animation: slideDown 0.3s ease-out; }
    .rx-safety-banner.is-visible { display: flex; }
    
    @keyframes slideDown { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body>

<div id="appRoot" class="app-root">

  <header class="top-bar">
    <div class="top-left">
      <div class="clinic-brand">
        <div class="logo-icon">ü©∫</div>
        <div class="brand-text">
          <div id="clinicNameDisplay" class="clinic-name">Solo Clinic</div>
          <div id="doctorNameDisplay" class="doctor-name">Dr. Yusuf Abbas</div>
        </div>
      </div>
      <div class="search-container">
        <div class="search-wrapper">
          <span class="search-icon">üîç</span>
          <input type="text" id="globalPatientSearch" placeholder="Search Patient (Alt+S)..." autocomplete="off" />
        </div>
        <div id="patientSearchResults" class="search-results-dropdown" aria-hidden="true"></div>
      </div>
    </div>
    
    <div class="top-center">
        <div class="live-clock-wrapper">
            <span id="liveTime" class="clock-time">--:--</span>
            <span id="liveDate" class="clock-date">--</span>
        </div>
    </div>

    <div class="top-right">
      <button id="themeToggleBtn" class="btn btn-icon" title="Toggle Dark Mode">üåô</button>
      <button id="shortcutsBtn" class="btn btn-icon" title="Shortcuts">‚å®Ô∏è</button>
      <div class="separator"></div>
      <button id="newPatientBtn" class="btn btn-primary"><span>+</span> New</button>
      <button id="saveVisitBtn" class="btn btn-success"><span>üíæ</span> Save</button>
      <button id="printBtn" class="btn btn-dark"><span>üñ®Ô∏è</span> Print</button>
      <button id="clinicSettingsBtn" class="btn btn-icon"><span>‚öôÔ∏è</span></button>
    </div>
  </header>

  <div id="currentPatientHeader" class="patient-context-strip is-hidden">
    <div class="context-left">
      <div class="avatar-circle" id="headerAvatar">P</div>
      <div class="patient-details">
        <div class="patient-name-row">
            <h2 id="headerName">Select a Patient</h2>
            <span id="visitStatus" class="status-badge draft">Draft</span>
        </div>
        <div class="patient-meta">
          <span id="headerUhid" class="meta-tag">UHID: --</span>
          <span id="headerAgeSex">-- / --</span>
          <span id="headerPhone">--</span>
        </div>
      </div>
    </div>
    <div class="context-right">
       <button id="calcBtn" class="btn btn-ghost btn-small">üßÆ BMI Calc</button>
       <button id="openHistoryBtn" class="btn btn-ghost btn-small">üïí History</button>
    </div>
  </div>

  <main class="main-layout">

    <aside class="panel panel-left">
      <div class="panel-header"><h3>Clinical Snapshot</h3></div>
      <div class="panel-content scrollable">
        <section class="form-section">
          <label class="section-label">Vitals</label>
          <div class="vitals-grid">
            <div class="vital-input"><label>BP</label><input id="vitalBP" placeholder="120/80" /></div>
            <div class="vital-input"><label>Pulse</label><input id="vitalPulse" placeholder="72" /></div>
            <div class="vital-input"><label>Temp</label><input id="vitalTemp" placeholder="98.6" /></div>
            <div class="vital-input"><label>SpO‚ÇÇ</label><input id="vitalSpO2" placeholder="99" /></div>
            <div class="vital-input"><label>Wt (kg)</label><input id="vitalWeight" placeholder="Kg" /></div>
            <div class="vital-input"><label>Ht (cm)</label><input id="vitalHeight" placeholder="cm" /></div>
          </div>
        </section>
        <hr class="divider"/>
        <section class="form-section">
          <label class="section-label" style="color:#dc2626;">Allergies ‚ö†Ô∏è</label>
          <textarea id="snapshotAllergies" class="warning-border" placeholder="Drug allergies..."></textarea>
        </section>
        <section class="form-section">
          <label class="section-label">Chronic History</label>
          <textarea id="snapshotChronic" placeholder="Diabetes, Hypertension..."></textarea>
        </section>
      </div>
    </aside>

    <section class="panel panel-center">
      <div class="visit-date-bar">
        <div style="display:flex; align-items:center; gap:8px;">
          <label>Visit Date:</label>
          <input type="date" id="visitDate" />
        </div>
        <button id="aiSuggestBtn" class="btn btn-magic-ghost" style="margin-left:auto;">
            ‚ú® AI Suggest <span id="aiLoading" class="ai-loader is-hidden"></span>
        </button>
      </div>

      <div class="clinical-tabs">
        <div class="tab-header-row">
          <button class="tab-btn active" data-tab="tab-co">Complaints</button>
          <button class="tab-btn" data-tab="tab-exam">Exam</button>
          <button class="tab-btn" data-tab="tab-dx">Diagnosis</button>
          <button class="tab-btn" data-tab="tab-rx">üíä Medicines</button>
          <button class="tab-btn" data-tab="tab-invest">Tests</button>
          <button class="tab-btn" data-tab="tab-advice">Advice</button>
        </div>
        
        <div class="tab-body-row">
          
          <div id="tab-co" class="tab-content active">
            <div class="smart-input-wrapper">
              <textarea id="coText" placeholder="Chief complaints..."></textarea>
              <button class="mic-btn" onclick="App.toggleDictation('coText', this)">üéôÔ∏è</button>
            </div>
          </div>

          <div id="tab-exam" class="tab-content">
            <div class="smart-input-wrapper">
              <div class="macro-bar">
                 <button class="macro-btn" onclick="App.insertMacro('examText', 'Chest Clear. S1 S2 Normal.')">ü´Å Normal Chest</button>
                 <button class="macro-btn" onclick="App.insertMacro('examText', 'Throat congested. Tonsils enlarged.')">üëÖ Sore Throat</button>
                 <button class="macro-btn" onclick="App.insertMacro('examText', 'P/A: Soft, non-tender. Bowel sounds present.')">‚úã Normal Abd</button>
                 <button class="macro-btn" onclick="App.insertMacro('examText', 'CNS: Conscious, Oriented. No focal deficit.')">üß† Normal CNS</button>
              </div>
              <textarea id="examText" placeholder="On Examination..."></textarea>
              <button class="mic-btn" onclick="App.toggleDictation('examText', this)">üéôÔ∏è</button>
            </div>
          </div>

          <div id="tab-dx" class="tab-content">
            <div class="smart-input-wrapper">
              <div class="macro-bar">
                 <button class="macro-btn" onclick="App.insertMacro('dxText', 'Viral Pyrexia')">Viral Fever</button>
                 <button class="macro-btn" onclick="App.insertMacro('dxText', 'Acute URI')">URI</button>
                 <button class="macro-btn" onclick="App.insertMacro('dxText', 'Acute Gastritis')">Gastritis</button>
                 <button class="macro-btn" onclick="App.insertMacro('dxText', 'Essential Hypertension')">HTN</button>
                 <button class="macro-btn" onclick="App.insertMacro('dxText', 'T2 Diabetes Mellitus')">Diabetes</button>
              </div>
              <textarea id="dxText" placeholder="Diagnosis..."></textarea>
              <button class="mic-btn" onclick="App.toggleDictation('dxText', this)">üéôÔ∏è</button>
            </div>
          </div>

          <div id="tab-rx" class="tab-content">
              <div class="rx-tab-layout">
                
                <div id="rxSafetyBanner" class="rx-safety-banner">
                    <div class="banner-content">
                        <span class="banner-icon">ü§ß</span>
                        <div class="banner-text">
                            <span class="banner-title">Allergy Alert</span>
                            <span id="rxAllergyText" class="banner-detail"></span>
                        </div>
                    </div>
                    <button id="dismissAllergyBtn" class="btn-dismiss-alert">Okay, Got it</button>
                </div>

                <div class="rx-input-deck">
                    <div class="rx-quick-chips-row">
                        <span class="chip-label">Form:</span>
                        <button class="chip-btn" onclick="App.setRxForm('Tab.')">üíä Tab</button>
                        <button class="chip-btn" onclick="App.setRxForm('Cap.')">üíä Cap</button>
                        <button class="chip-btn" onclick="App.setRxForm('Syr.')">ü•Ñ Syr</button>
                        <button class="chip-btn" onclick="App.setRxForm('Inj.')">üíâ Inj</button>
                        <button class="chip-btn" onclick="App.setRxForm('Oint.')">üß¥ Oint</button>
                        <button class="chip-btn" onclick="App.setRxForm('Drops')">üíß Drops</button>
                    </div>

                    <div class="rx-grid-row">
                        <div class="input-group drug-group">
                            <label>Medicine Name</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üîç</span>
                                <input id="rxDrugName" placeholder="Search brand or generic..." autocomplete="off" />
                            </div>
                            <div id="drugSuggestions" class="suggestions-dropdown" aria-hidden="true"></div>
                        </div>
                        <div class="input-group small"><label>Dose</label><input id="rxDose" placeholder="500mg" /></div>
                        <div class="input-group small">
                            <label>Freq</label>
                            <input id="rxFrequency" placeholder="BD" list="freqList" />
                            <datalist id="freqList">
                                <option value="OD">Once a day</option>
                                <option value="BD">Twice a day</option>
                                <option value="TDS">Thrice a day</option>
                                <option value="QD">Four times a day</option>
                                <option value="SOS">As needed</option>
                                <option value="HS">At night</option>
                            </datalist>
                        </div>
                        <div class="input-group small"><label>Duration</label><input id="rxDuration" placeholder="5 Days" /></div>
                    </div>
                    
                    <div class="rx-grid-row bottom">
                        <div class="input-group full">
                            <label>Instructions / Remarks</label>
                            <input id="rxRemarks" placeholder="e.g. After food..." />
                            <div class="quick-duration-bar">
                                <button class="dur-chip" onclick="App.setRxDuration('3 Days')">3D</button>
                                <button class="dur-chip" onclick="App.setRxDuration('5 Days')">5D</button>
                                <button class="dur-chip" onclick="App.setRxDuration('7 Days')">7D</button>
                                <button class="dur-chip" onclick="App.setRxDuration('15 Days')">15D</button>
                                <button class="dur-chip" onclick="App.setRxDuration('1 Mon')">1M</button>
                            </div>
                        </div>
                        <div class="rx-action-group">
                            <span id="editingIndicator" class="editing-badge is-hidden">‚úèÔ∏è Editing</span>
                            <button id="addRxBtn" class="btn btn-primary btn-add-rx">
                                <span class="plus-icon">+</span> <span id="addRxBtnText">Add Med</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="rx-list-wrapper">
                  <table class="rx-table cute-table">
                    <thead><tr><th width="40">#</th><th>Medicine Detail</th><th>Dose</th><th>Timing</th><th>Dur</th><th width="60"></th></tr></thead>
                    <tbody id="rxTableBody"></tbody>
                  </table>
                  <div id="rxEmptyState" class="rx-empty">
                      <div class="empty-icon">üíä</div>
                      <div class="empty-text">Prescription is empty</div>
                      <div class="empty-sub">Search above to add medicines</div>
                  </div>
                </div>

             </div>
          </div>

          <div id="tab-invest" class="tab-content">
             <div class="smart-input-wrapper">
              <textarea id="investText" placeholder="Labs (PT/INR)..."></textarea>
              <button class="mic-btn" onclick="App.toggleDictation('investText', this)">üéôÔ∏è</button>
            </div>
          </div>

          <div id="tab-advice" class="tab-content">
             <div class="smart-input-wrapper">
              <div class="macro-bar">
                 <button class="macro-btn" onclick="App.insertMacro('adviceText', 'Drink plenty of fluids.\nAvoid cold/oily food.')">General</button>
                 <button class="macro-btn" onclick="App.insertMacro('adviceText', 'Salt restricted diet.\nRegular exercise.')">BP Care</button>
                 <button class="macro-btn" onclick="App.insertMacro('adviceText', 'Review after 3 days.')">Review</button>
              </div>
              <textarea id="adviceText" placeholder="General Advice..."></textarea>
              <button class="mic-btn" onclick="App.toggleDictation('adviceText', this)">üéôÔ∏è</button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <aside class="panel panel-right">
      <div class="preview-wrapper">
        <div class="paper-sheet">
          
          <div class="paper-header">
            <div class="header-logo-row">
                <div class="logo-box">ü©∫</div> <div class="clinic-info-box">
                    <h1 id="previewClinicName">SOLO CLINIC</h1>
                    <h2 id="previewDoctorName">Dr. Yusuf Abbas</h2>
                    <p id="previewClinicAddress" class="clinic-addr">123 Health St, Medical District</p>
                </div>
            </div>
            <div class="paper-hr-thick"></div>
          </div>

          <div class="paper-patient-grid">
            <div class="meta-item">
                <span class="meta-label">Patient Name:</span>
                <span id="previewPatientName" class="meta-val">--</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Age / Sex:</span>
                <span id="previewPatientAgeSex" class="meta-val">--</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Visit ID:</span>
                <span id="previewPatientId" class="meta-val">--</span>
            </div>
            <div class="meta-item align-right">
                <span class="meta-label">Date:</span>
                <span id="previewDatePrint" class="meta-val">--</span>
            </div>
          </div>
          <div class="paper-hr-thin"></div>

          <div class="paper-body">
            
            <div id="previewVitalsRow" class="paper-vitals-box">
                <span class="vitals-title">VITALS:</span>
                <span id="previewVitals" class="vitals-content"></span>
            </div>

            <div id="previewSectionCO" class="paper-section">
                <div class="paper-label">Chief Complaints:</div> 
                <span id="previewCO"></span>
            </div>
            <div id="previewSectionExam" class="paper-section">
                <div class="paper-label">Examination:</div> 
                <span id="previewExam"></span>
            </div>
            <div id="previewSectionDx" class="paper-section">
                <div class="paper-label">Diagnosis:</div> 
                <span id="previewDx" style="font-weight:bold;"></span>
            </div>
            <div id="previewSectionInvest" class="paper-section">
                <div class="paper-label">Investigations:</div> 
                <span id="previewInvest"></span>
            </div>
            
            <div class="paper-section rx-section-print">
              <div class="rx-symbol">‚Ñû</div>
              <table class="paper-rx-table">
                  <thead>
                      <tr>
                          <th class="col-type">#</th>
                          <th class="col-med">Medicine Name</th>
                          <th class="col-dose">Dose</th>
                          <th class="col-freq">Timing</th>
                          <th class="col-dur">Dur</th>
                          <th class="col-remark">Instruction</th>
                      </tr>
                  </thead>
                  <tbody id="previewRxTable"></tbody>
              </table>
            </div>

            <div id="previewSectionAdvice" class="paper-section advice-box">
                <div class="paper-label">Advice / Follow-up:</div> 
                <span id="previewAdvice"></span>
            </div>
          </div>

          <div class="paper-footer">
            <div class="footer-note" id="previewFooterNote">Get well soon!</div>
            <div class="signature-box">
                <div class="sign-img"></div>
                <div class="sign-label">Doctor's Signature</div>
            </div>
          </div>

        </div>
      </div>
    </aside>

  </main>

  <div id="newPatientModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header"><h2>New Patient</h2><button id="closeNewPatientBtn" class="close-btn">√ó</button></div>
      <div class="modal-body">
        <div class="form-row"><div class="form-group"><label>Name *</label><input id="regName" /></div></div>
        <div class="form-row">
            <div class="form-group"><label>Phone</label><input id="regPhone" /></div>
            <div class="form-group small"><label>Age</label><input id="regAge" type="number" /></div>
            <div class="form-group small"><label>Sex</label><select id="regSex"><option value="M">M</option><option value="F">F</option></select></div>
        </div>
        <div class="form-row"><div class="form-group"><label>Allergies</label><textarea id="regAllergies"></textarea></div></div>
        <div class="form-row"><div class="form-group"><label>Conditions</label><textarea id="regChronic"></textarea></div></div>
      </div>
      <div class="modal-footer"><button id="saveNewPatientBtn" class="btn btn-primary">Register (Alt+S)</button></div>
    </div>
  </div>

  <div id="settingsModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header"><h2>Settings</h2><button id="closeSettingsBtn" class="close-btn">√ó</button></div>
      <div class="modal-body">
        <label>Clinic Name</label><input id="settingClinicName" />
        <label>Doctor Name</label><input id="settingDoctorName" />
        <label>Address</label><textarea id="settingClinicAddress"></textarea>
        <label>Footer Note</label><textarea id="settingFooterNote"></textarea>
      </div>
      <div class="modal-footer"><button id="saveSettingsBtn" class="btn btn-primary">Save Changes</button></div>
    </div>
  </div>

  <div id="shortcutsModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-card" style="width:400px;">
      <div class="modal-header"><h2>Keyboard Shortcuts</h2><button id="closeShortcutsBtn" class="close-btn">√ó</button></div>
      <div class="modal-body">
        <ul style="list-style:none; padding:0; line-height:2;">
            <li><b>Alt + N</b> : New Patient</li>
            <li><b>Alt + S</b> : Search Patient</li>
            <li><b>Ctrl + S</b> : Save Visit</li>
            <li><b>Ctrl + P</b> : Print</li>
            <li><b>Esc</b> : Close Modals</li>
        </ul>
      </div>
    </div>
  </div>

  <div id="historyDrawer" class="drawer-overlay" aria-hidden="true">
    <div class="drawer-content">
      <div class="drawer-header"><h3>History</h3><button id="closeHistoryBtn" class="close-btn">√ó</button></div>
      <div id="historyList" class="drawer-body-scroll"></div>
    </div>
  </div>

</div>

<nav id="mobileNav" class="mobile-nav-bar">
  <button class="mob-nav-btn" onclick="MobileApp.switchView('snapshot')">
    <span class="icon">üìä</span>
    <span class="label">Vitals</span>
  </button>
  <button class="mob-nav-btn active" onclick="MobileApp.switchView('editor')">
    <span class="icon">‚úçÔ∏è</span>
    <span class="label">Clinical</span>
  </button>
  <button class="mob-nav-btn" onclick="MobileApp.switchView('preview')">
    <span class="icon">üìÑ</span>
    <span class="label">Preview</span>
  </button>
</nav>

<script src="meds_all_combined.js"></script>
<script src="script.js"></script>
</body>
</html>